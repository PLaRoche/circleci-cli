#!/usr/bin/env bats

function setup() {
  if [ -z "${CIRCLECI_CLI_TOKEN}" ]; then
    skip "Environment variable not defined"
  fi

  sleep 2
}

@test "init should succeed predictably" {
  build/bin/circleci init --token=${CIRCLECI_CLI_TOKEN}
}

@test "artifacts should succeed predictably" {
  run build/bin/circleci artifacts rockymadden/circleci-cli 1
  [ ${status} -eq 0 ]
  [ "${output}" = '[]' ]
}

@test "build should succeed predictably" {
  run build/bin/circleci build rockymadden/circleci-cli 1 --filter='.build_num'
  [ ${status} -eq 0 ]
  [ "${output}" = '1' ]
}

@test "builds should succeed predictably" {
  run build/bin/circleci builds rockymadden/circleci-cli --filter='.[] | .build_num'
  [ ${status} -eq 0 ]
  [ "${#lines[@]}" -gt 1 ]
}

@test "me should succeed predictably" {
  run build/bin/circleci me --filter='.login'
  [ ${status} -eq 0 ]
  [ "${output}" = 'rockymadden' ]
}

@test "project should succeed predictably" {
  run build/bin/circleci project rockymadden/circleci-cli --filter='.username + "/" + .reponame'
  [ ${status} -eq 0 ]
  [ "${output}" = 'rockymadden/circleci-cli' ]
}

@test "projects should succeed predictably" {
  run build/bin/circleci projects --filter='.[] | .username + "/" + .reponame'
  [ ${status} -eq 0 ]
  [ "${#lines[@]}" -gt 1 ]
}
